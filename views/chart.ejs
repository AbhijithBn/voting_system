<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Voting Chart</title>

  <script >
      // this is to plot the graph

      window.onclick = function () {  // can be window.onload but graph refreshes only after you refresh the entire window again

            fetch('/peoplecount')
            .then((res) =>res.json())
            .then((data)=>
            {

              var dataPoints1=[];// this s for people in
              var dataPoints2=[];// this is for people out


              var chart=new CanvasJS.Chart("peoplecounterday",{
                backgroundColor: "#F5DEB3",

                title:{
                  text:"Counter Chart"
                },
                axisX:{
                  title:"Count",
                  fontSize: 18,
                },
                axisY:{
                  title:"Value",
                  fontSize: 18,
                },
                legend: {
                  cursor:"pointer",
                  verticalAlign: "top",
                  fontSize: 22,
                  fontColor: "dimGrey",
                  itemclick : toggleDataSeries
                },
                data:[{   // since all of them are of the same data types , we have an array of objects
                  type:"column",
                  name:"In",
                  xValueType:"dateTime",
                  xValueFormatString: "hh:mm:ss TT",//keeping a track on an hourly basis
                  dataPoints:dataPoints1,
                  showInLegend: true,
                  // borderColor:'red',
                  // backgroundColor:'orange',
                  // hoverBackgroundColor:'rgb(240, 110, 59)',

                },
                {
                  type:"column",
                  name:"Out",
                  xValueType:"dateTime",
                  xValueFormatString: "hh:mm:ss TT",//keeping a track on an hourly basis
                  dataPoints:dataPoints2,
                  showInLegend: true
                }]
              });
              function toggleDataSeries(e) {
                if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                  e.dataSeries.visible = false;
                }
                else {
                  e.dataSeries.visible = true;
                }
                chart.render();
              }

              var updateInterval = 3000;

              var yValue1 = 0;//initial y values for both people in and people out
              var yValue2 = 0;

              var time = new Date;// this returns the current date


              var time_hour= time.getHours();// this returns the current hours which has to be queried
              console.log(time_hour);

              function updateChart()
              {
                dataPoints1.push({
                x: time.getTime(),
                y: data.in

              });



              dataPoints2.push({
                x: time.getTime(),
                y: data.out

              });
              chart.options.data[0].legendText = " people in :" + data.in;
	            chart.options.data[1].legendText = " people out :" + data.out;

              chart.render();

              }
              updateChart();

              setInterval(function(){updateChart},updateInterval);




            })
          }

  </script>



</head>
<body style="background-color: #F5DEB3">


  <div id="peoplecounterday" style="height: 200px; width: 100%; justify-content: center;">
  </div>

  <script src="https://canvasjs.com/assets/script/canvasjs.min.js">
  </script>






</body>
</html>
